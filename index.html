<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Italian Color Trainer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif&family=DM+Sans:opsz,wght@9..40,300..700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f0e0c;
      --fg: #e5e0d8;
      --fg-dim: #a39e94;
      --accent: #c8956c;
      --accent-soft: rgba(200,149,108,.12);
      --card: #171614;
      --card-border: #2a2722;
      --radius: 14px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { -webkit-tap-highlight-color: transparent; }
    body {
      font-family: 'DM Sans', system-ui, sans-serif;
      background: var(--bg); color: var(--fg);
      min-height: 100dvh; padding: 1.5rem 1rem 2.5rem;
      text-align: center; overflow-x: hidden;
    }

    header { margin-bottom: 1.25rem; }
    h1 {
      font-family: 'Instrument Serif', Georgia, serif;
      font-size: 1.75rem; font-weight: 400;
      letter-spacing: .01em; margin-bottom: .2rem;
    }
    .hint { color: var(--fg-dim); font-size: .78rem; line-height: 1.4; }
    .hint b { color: var(--accent); font-weight: 500; }
    .hint-desktop { display: none; }
    @media(min-width:600px){ .hint-mobile{display:none} .hint-desktop{display:inline} }

    #swatchWrap { display: flex; justify-content: center; margin-bottom: .25rem; }
    #swatch {
      width: min(70vw, 280px);
      height: min(45vw, 180px);
      border-radius: 16px;
      border: 3px solid var(--card-border);
      transition: background-color .3s ease, border-color .3s ease;
      box-shadow: 0 8px 32px rgba(0,0,0,.4);
    }

    #answerBlock {
      min-height: 5.5rem; display: flex; flex-direction: column;
      align-items: center; justify-content: center; gap: .1rem; margin: .25rem 0;
    }

    /* DEFAULT: display:none. No transitions. Completely invisible. */
    #colorName {
      font-family: 'Instrument Serif', Georgia, serif;
      font-size: clamp(1.4rem, 1rem + 1.5vw, 2rem);
      line-height: 1.3; color: var(--fg);
      display: none;
    }
    #colorNote {
      font-family: 'DM Sans', sans-serif;
      font-size: .82rem; color: var(--fg-dim);
      display: none;
    }

    /* .show makes them visible with a one-shot animation */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(5px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }
    #colorName.show {
      display: block;
      animation: fadeUp .25s ease forwards;
    }
    #colorNote.show {
      display: block;
      animation: fadeIn .22s ease .08s both;
    }

    #timer {
      font-family: 'JetBrains Mono', monospace; font-size: .95rem;
      color: var(--fg-dim); transition: color .15s; margin-top: .1rem;
    }
    #timer.fast { color: var(--accent); }

    #progress {
      font-family: 'JetBrains Mono', monospace;
      font-size: .72rem; color: var(--fg-dim);
      margin-top: .15rem;
    }

    #tapBtn {
      display: flex; align-items: center; justify-content: center; gap: .45rem;
      width: 100%; max-width: 300px; margin: .75rem auto;
      padding: .8rem 1rem;
      font-family: 'DM Sans', sans-serif; font-size: .95rem; font-weight: 500;
      color: var(--bg); background: var(--accent); border: none; border-radius: 12px;
      cursor: pointer; -webkit-user-select: none; user-select: none;
      transition: transform .08s, opacity .08s;
    }
    #tapBtn:active { transform: scale(.97); opacity: .85; }
    #tapBtn svg { width: 16px; height: 16px; flex-shrink: 0; }

    #controls {
      display: flex; flex-wrap: wrap; gap: .35rem; justify-content: center;
      margin: .35rem auto .75rem; max-width: 440px;
    }
    .btn {
      font-family: 'DM Sans', sans-serif; font-size: .78rem; font-weight: 500;
      padding: .4rem .65rem; border-radius: 10px;
      border: 1px solid var(--card-border); background: var(--card);
      color: var(--fg-dim); cursor: pointer; transition: all .15s;
      -webkit-user-select: none; user-select: none;
    }
    .btn:active { transform: translateY(1px); }
    .btn.active { background: var(--accent-soft); color: var(--accent); border-color: rgba(200,149,108,.3); }
    .btn.ghost { border-color: transparent; background: transparent; }

    .divider { width: 40px; height: 1px; background: var(--card-border); margin: 1rem auto; }

    .stats-bar {
      display: flex; justify-content: center; gap: 1.25rem; flex-wrap: wrap;
      background: var(--card); border: 1px solid var(--card-border);
      border-radius: var(--radius); padding: .6rem 1rem;
      max-width: 440px; margin: 0 auto;
    }
    .stat-item { display: flex; flex-direction: column; align-items: center; gap: .05rem; }
    .stat-val { font-family: 'JetBrains Mono', monospace; font-size: .85rem; font-weight: 500; color: var(--fg); }
    .stat-label { font-size: .65rem; color: var(--fg-dim); text-transform: uppercase; letter-spacing: .06em; }

    .tip {
      color: var(--fg-dim); font-size: .75rem; max-width: 440px;
      margin: .75rem auto 0; line-height: 1.4;
    }
    .tip b { color: var(--accent); font-weight: 500; }
  </style>
</head>
<body>
  <header>
    <h1>Di che colore è?</h1>
    <p class="hint">
      <span class="hint-mobile">Tap to reveal, tap again for next</span>
      <span class="hint-desktop"><b>Space</b> reveal / next · <b>Enter</b> advance</span>
    </p>
  </header>

  <div id="swatchWrap">
    <div id="swatch"></div>
  </div>

  <div id="answerBlock">
    <div id="colorName"></div>
    <div id="colorNote"></div>
    <div id="timer">0.000 s</div>
    <div id="progress"></div>
  </div>

  <button id="tapBtn" onclick="handleTap()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
    <span id="tapLabel">Cominciamo</span>
  </button>

  <div id="controls">
    <button class="btn active" id="modeBasic" onclick="setMode('basic')">Base (11)</button>
    <button class="btn" id="modeExt" onclick="setMode('extended')">Esteso (26)</button>
    <button class="btn ghost" onclick="clearStats()">Azzera</button>
  </div>

  <div class="divider"></div>

  <div class="stats-bar">
    <div class="stat-item"><span class="stat-val" id="count">0</span><span class="stat-label">Trials</span></div>
    <div class="stat-item"><span class="stat-val" id="avg">—</span><span class="stat-label">Avg</span></div>
    <div class="stat-item"><span class="stat-val" id="best">—</span><span class="stat-label">Best</span></div>
    <div class="stat-item"><span class="stat-val" id="p95">—</span><span class="stat-label">P95</span></div>
  </div>

  <p class="tip">Colors marked <b>inv.</b> don't change with gender. Others show m/f forms. Every color appears once per round, then reshuffles.</p>

<script>
/* ================================================================
   ITALIAN COLOR TRAINER
   ================================================================ */

var BASIC = [
  ['#FF0000', 'rosso', 'rosso / rossa'],
  ['#0000FF', 'blu', 'inv. — always blu'],
  ['#3CB043', 'verde', 'inv. — verde'],
  ['#FFFF00', 'giallo', 'giallo / gialla'],
  ['#FFA500', 'arancione', 'inv. — arancione'],
  ['#FFFFFF', 'bianco', 'bianco / bianca'],
  ['#000000', 'nero', 'nero / nera'],
  ['#6B7280', 'grigio', 'grigio / grigia'],
  ['#FFC0CB', 'rosa', 'inv. — always rosa'],
  ['#800080', 'viola', 'inv. — always viola'],
  ['#964B00', 'marrone', 'inv. — marrone']
];

var EXTENDED = BASIC.concat([
  ['#63C5DA', 'azzurro', 'azzurro / azzurra — light blue, the sky'],
  ['#000080', 'blu scuro', 'inv. — dark/navy blue'],
  ['#89CFF0', 'celeste', 'inv. — sky/pale blue'],
  ['#0B6623', 'verde scuro', 'inv. — dark green'],
  ['#86EFAC', 'verde chiaro', 'inv. — light green'],
  ['#AB0B23', 'rosso scuro', 'inv. — dark red'],
  ['#FCA5A5', 'rosso chiaro', 'inv. — light red / pinkish'],
  ['#FFFFA7', 'giallo chiaro', 'inv. — pale/light yellow'],
  ['#E1AD01', 'giallo scuro', 'inv. — dark yellow / mustard'],
  ['#C0C0C0', 'argento / argentato', 'argentato / argentata — silver'],
  ['#F5F5DC', 'beige', 'inv. — always beige'],
  ['#D2B48C', 'color nocciola', 'inv. — hazelnut / tan'],
  ['#FFF5E1', 'panna / color crema', 'inv. — cream'],
  ['#008080', 'verde acqua', 'inv. — teal / aqua'],
  ['#4B0082', 'indaco', 'inv. — indigo']
]);

/* ── State ── */
var mode = 'basic';
var queue = [];
var cursor = 0;
var roundNum = 0;
var started = false;
var revealed = false;
var startTime = null;

var swatchEl = document.getElementById('swatch');
var nameEl = document.getElementById('colorName');
var noteEl = document.getElementById('colorNote');
var timerEl = document.getElementById('timer');
var tapLabel = document.getElementById('tapLabel');
var progressEl = document.getElementById('progress');

/* Fisher-Yates — always returns a fresh array */
function shuffle(src) {
  var a = [];
  for (var i = 0; i < src.length; i++) a[i] = src[i];
  for (var i = a.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var tmp = a[i]; a[i] = a[j]; a[j] = tmp;
  }
  return a;
}

function getPool() { return mode === 'basic' ? BASIC : EXTENDED; }

function startNewRound() {
  queue = shuffle(getPool());
  cursor = 0;
  roundNum++;
  console.log('=== ROUND ' + roundNum + ' (' + queue.length + ' colors) ===');
  for (var i = 0; i < queue.length; i++) {
    console.log('  ' + (i + 1) + '. ' + queue[i][1]);
  }
}

function setMode(m) {
  mode = m;
  document.getElementById('modeBasic').classList.toggle('active', m === 'basic');
  document.getElementById('modeExt').classList.toggle('active', m === 'extended');
  roundNum = 0;
  started = false;
  nameEl.className = '';
  noteEl.className = '';
  nameEl.textContent = '';
  noteEl.textContent = '';
  progressEl.textContent = '';
  timerEl.textContent = '0.000 s';
  timerEl.classList.remove('fast');
  tapLabel.textContent = 'Cominciamo';
}

function showNext() {
  if (cursor >= queue.length) {
    startNewRound();
  }

  var color = queue[cursor];
  console.log('→ cursor=' + cursor + ' showing: ' + color[1]);

  // 1. Hide answer — className='' removes .show, so display:none takes effect
  nameEl.className = '';
  noteEl.className = '';

  // 2. Set text while display:none — guaranteed no flash
  nameEl.textContent = color[1];
  noteEl.textContent = color[2];

  // 3. Update swatch
  swatchEl.style.backgroundColor = color[0];
  var r = parseInt(color[0].slice(1, 3), 16) || 0;
  var g = parseInt(color[0].slice(3, 5), 16) || 0;
  var b = parseInt(color[0].slice(5, 7), 16) || 0;
  var lum = (r * 299 + g * 587 + b * 114) / 1000;
  swatchEl.style.borderColor = lum > 200 ? '#3a3835' : '#2a2722';

  // 4. Progress
  progressEl.textContent = (cursor + 1) + ' / ' + queue.length + '  ·  round ' + roundNum;

  // 5. Timer
  timerEl.textContent = '0.000 s';
  timerEl.classList.remove('fast');

  startTime = performance.now();
  revealed = false;
  tapLabel.textContent = 'Rivela';
}

function revealAnswer() {
  var elapsed = (performance.now() - startTime) / 1000;
  timerEl.textContent = elapsed.toFixed(3) + ' s';
  timerEl.classList.add('fast');

  // Show answer
  nameEl.className = 'show';
  noteEl.className = 'show';

  revealed = true;
  cursor++;
  recordTrial(elapsed);
  tapLabel.textContent = 'Avanti';
}

function handleTap() {
  if (!started) {
    started = true;
    startNewRound();
    showNext();
    return;
  }
  if (!revealed) {
    revealAnswer();
  } else {
    showNext();
  }
}

document.addEventListener('keydown', function(e) {
  if (e.code === 'Space') { e.preventDefault(); handleTap(); }
  else if (e.code === 'Enter' && revealed) { showNext(); }
});

/* ── Stats ── */
var times = [];
var avgEl2 = document.getElementById('avg');
var countEl2 = document.getElementById('count');
var bestEl2 = document.getElementById('best');
var p95El2 = document.getElementById('p95');

function recordTrial(s) {
  if (!isFinite(s) || s <= 0) return;
  times.push(s);
  updateStats();
}
function clearStats() { times.length = 0; updateStats(); }
function updateStats() {
  var n = times.length;
  countEl2.textContent = n;
  if (!n) { avgEl2.textContent = '—'; bestEl2.textContent = '—'; p95El2.textContent = '—'; return; }
  var sum = 0;
  var mn = times[0];
  for (var i = 0; i < n; i++) {
    sum += times[i];
    if (times[i] < mn) mn = times[i];
  }
  avgEl2.textContent = (sum / n).toFixed(2) + 's';
  bestEl2.textContent = mn.toFixed(2) + 's';
  var sorted = times.slice().sort(function(a, b) { return a - b; });
  var idx = Math.max(0, Math.min(n - 1, Math.ceil(0.95 * n) - 1));
  p95El2.textContent = sorted[idx].toFixed(2) + 's';
}
</script>
</body>
</html>
